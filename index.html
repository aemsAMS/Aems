<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø³Ø§Ø¨Ù‚Ù‡ Ù…Ø§Ø´ÛŒÙ† Ø¨Ù„Ø§Ú©Ú†ÛŒÙ†ÛŒ</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js"></script>
    <style>
        * {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            box-sizing: border-box;
        }
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            color: white;
            text-align: center;
            padding: 20px;
            min-height: 100vh;
            margin: 0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 0 30px rgba(0, 0, 255, 0.5);
        }
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 0 10px #00f7ff;
        }
        .section {
            background: rgba(30, 30, 60, 0.8);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #4d4dff;
        }
        button {
            background: linear-gradient(to right, #4e54c8, #8f94fb);
            color: white;
            border: none;
            padding: 15px 25px;
            margin: 10px;
            border-radius: 50px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 255, 0.6);
        }
        button:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .wallet-info {
            font-size: 1.1rem;
            margin: 15px;
            padding: 10px;
            background: rgba(0, 0, 50, 0.6);
            border-radius: 10px;
            display: inline-block;
        }
        .error {
            color: #ff6b6b;
            background: rgba(255, 0, 0, 0.1);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .hidden {
            display: none;
        }
        .network-info {
            background: rgba(0, 100, 0, 0.3);
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš— Ù…Ø³Ø§Ø¨Ù‚Ù‡ Ù…Ø§Ø´ÛŒÙ† Ø¨Ù„Ø§Ú©Ú†ÛŒÙ†ÛŒ</h1>
        
        <div id="connectSection" class="section">
            <h2>Ø§ØªØµØ§Ù„ Ú©ÛŒÙ Ù¾ÙˆÙ„</h2>
            <button id="connectWallet">Ø§ØªØµØ§Ù„ Ú©ÛŒÙ Ù¾ÙˆÙ„</button>
            <div id="walletInfo" class="wallet-info hidden">
                <div>Ø¢Ø¯Ø±Ø³: <span id="walletAddress"></span></div>
                <div>Ù…ÙˆØ¬ÙˆØ¯ÛŒ: <span id="tokenBalance"></span> TOKEN</div>
                <div>Ø´Ø¨Ú©Ù‡: <span id="networkName"></span></div>
            </div>
            <div id="errorInfo" class="error hidden"></div>
            <div id="networkInfo" class="network-info hidden">
                <p>âš ï¸ Ù„Ø·ÙØ§Ù‹ Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ Ø¨Ù‡ Ø´Ø¨Ú©Ù‡ <strong>Binance Smart Chain</strong> Ù…ØªØµÙ„ Ù‡Ø³ØªÛŒØ¯</p>
                <button id="switchNetwork">ØªØºÛŒÛŒØ± Ø¨Ù‡ Ø´Ø¨Ú©Ù‡ Binance</button>
            </div>
        </div>
    </div>

    <script>
        // =============== ØªÙ†Ø¸ÛŒÙ…Ø§Øª ===============
        const BSC_MAINNET = {
            chainId: "0x38", // 56 in decimal
            chainName: "Binance Smart Chain",
            nativeCurrency: {
                name: "BNB",
                symbol: "BNB",
                decimals: 18
            },
            rpcUrls: ["https://bsc-dataseed.binance.org/"],
            blockExplorerUrls: ["https://bscscan.com"]
        };

        // =============== Ø¹Ù†Ø§ØµØ± DOM ===============
        const connectWalletBtn = document.getElementById('connectWallet');
        const walletInfoDiv = document.getElementById('walletInfo');
        const walletAddressSpan = document.getElementById('walletAddress');
        const tokenBalanceSpan = document.getElementById('tokenBalance');
        const networkNameSpan = document.getElementById('networkName');
        const errorInfoDiv = document.getElementById('errorInfo');
        const networkInfoDiv = document.getElementById('networkInfo');
        const switchNetworkBtn = document.getElementById('switchNetwork');
        
        // =============== Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ú©ÛŒÙ Ù¾ÙˆÙ„ ===============
        async function connectWallet() {
            try {
                // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø®Ø·Ø§Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
                errorInfoDiv.classList.add('hidden');
                
                // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ù…ØªØ§Ù…Ø³Ú©
                if (!window.ethereum) {
                    throw new Error("Ù…ØªØ§Ù…Ø³Ú© ÛŒØ§ÙØª Ù†Ø´Ø¯! Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ù…ØªØ§Ù…Ø³Ú© Ø±Ø§ Ù†ØµØ¨ Ú©Ù†ÛŒØ¯.");
                }
                
                // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§
                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                
                // ØªÙ†Ø¸ÛŒÙ… Ø§Ø±Ø§Ø¦Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ù‡ Ø§ØªØ±Ø²
                const provider = new ethers.providers.Web3Provider(window.ethereum);
                const network = await provider.getNetwork();
                
                // Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø¨Ú©Ù‡
                networkNameSpan.textContent = network.name;
                
                // Ø¨Ø±Ø±Ø³ÛŒ Ø´Ø¨Ú©Ù‡
                if (network.chainId !== 56) {
                    networkInfoDiv.classList.remove('hidden');
                    return;
                }
                
                // Ø¯Ø±ÛŒØ§ÙØª Ø¢Ø¯Ø±Ø³ Ú©ÛŒÙ Ù¾ÙˆÙ„
                const userAddress = accounts[0];
                walletAddressSpan.textContent = `${userAddress.substring(0, 6)}...${userAddress.substring(38)}`;
                
                // Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆØ¬ÙˆØ¯ÛŒ ØªÙˆÚ©Ù†
                const tokenContract = new ethers.Contract(
                    "0x259115680169276d0e4286acba362460456697c5",
                    ['function balanceOf(address) view returns (uint256)'],
                    provider
                );
                
                const balance = await tokenContract.balanceOf(userAddress);
                tokenBalanceSpan.textContent = ethers.utils.formatUnits(balance, 18);
                
                // Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª
                walletInfoDiv.classList.remove('hidden');
                connectWalletBtn.textContent = "Ø§ØªØµØ§Ù„ Ù…Ø¬Ø¯Ø¯ Ú©ÛŒÙ Ù¾ÙˆÙ„";
                
            } catch (error) {
                console.error("Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„:", error);
                showError(error.message || "Ø®Ø·Ø§ÛŒ Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ú©ÛŒÙ Ù¾ÙˆÙ„");
            }
        }
        
        // =============== ØªØºÛŒÛŒØ± Ø´Ø¨Ú©Ù‡ ===============
        async function switchToBscNetwork() {
            try {
                await window.ethereum.request({
                    method: 'wallet_addEthereumChain',
                    params: [BSC_MAINNET]
                });
                
                // Ù¾Ø³ Ø§Ø² ØªØºÛŒÛŒØ± Ø´Ø¨Ú©Ù‡ØŒ Ø§ØªØµØ§Ù„ Ø±Ø§ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯
                setTimeout(connectWallet, 1000);
                
            } catch (error) {
                console.error("Ø®Ø·Ø§ Ø¯Ø± ØªØºÛŒÛŒØ± Ø´Ø¨Ú©Ù‡:", error);
                showError("Ø§Ù…Ú©Ø§Ù† ØªØºÛŒÛŒØ± Ø´Ø¨Ú©Ù‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¯Ø³ØªÛŒ Ø¨Ù‡ Ø´Ø¨Ú©Ù‡ Binance ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯.");
            }
        }
        
        // =============== Ù†Ù…Ø§ÛŒØ´ Ø®Ø·Ø§ ===============
        function showError(message) {
            errorInfoDiv.textContent = message;
            errorInfoDiv.classList.remove('hidden');
        }
        
        // =============== Ú¯ÙˆØ´ Ø¯Ø§Ø¯Ù† Ø¨Ù‡ ØªØºÛŒÛŒØ± Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§ ===============
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length > 0) {
                    connectWallet();
                } else {
                    walletInfoDiv.classList.add('hidden');
                    connectWalletBtn.textContent = "Ø§ØªØµØ§Ù„ Ú©ÛŒÙ Ù¾ÙˆÙ„";
                }
            });
            
            window.ethereum.on('chainChanged', (chainId) => {
                // ÙˆÙ‚ØªÛŒ Ø´Ø¨Ú©Ù‡ ØªØºÛŒÛŒØ± Ú©Ø±Ø¯ØŒ ØµÙØ­Ù‡ Ø±Ø§ Ø±ÙØ±Ø´ Ú©Ù†ÛŒØ¯
                window.location.reload();
            });
        }
        
        // =============== Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø¯Ú©Ù…Ù‡ ===============
        connectWalletBtn.addEventListener('click', connectWallet);
        if (switchNetworkBtn) {
            switchNetworkBtn.addEventListener('click', switchToBscNetwork);
        }
        
        // =============== Ø¨Ø±Ø±Ø³ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø§ØªØµØ§Ù„ ===============
        async function checkInitialConnection() {
            if (window.ethereum && window.ethereum.selectedAddress) {
                await connectWallet();
            }
        }
        
        // Ø§Ø¬Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØµÙØ­Ù‡
        window.addEventListener('load', checkInitialConnection);
    </script>
</body>
</html> 
